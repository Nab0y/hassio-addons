name: CI

on:
  push:
  pull_request:
    types: [opened, reopened, synchronize]
  schedule:
    - cron: "0 2 * * 0"

jobs:
  information:
    name: Gather add-on information
    runs-on: ubuntu-latest
    outputs:
      changed_addons: ${{ steps.changed_addons.outputs.addons }}
      changed: ${{ steps.changed_addons.outputs.changed }}
    steps:
      - name: ⤵️ Check out code from GitHub
        uses: actions/checkout@v4

      - name: 🚀 Run add-on information action
        id: changed_addons
        uses: home-assistant/actions/helpers/info@master

  lint:
    name: Lint add-on
    runs-on: ubuntu-latest
    needs: information
    if: needs.information.outputs.changed == 'true'
    strategy:
      matrix:
        addon: ${{ fromJson(needs.information.outputs.changed_addons) }}
    steps:
      - name: ⤵️ Check out code from GitHub
        uses: actions/checkout@v4

      - name: 🚀 Run Add-on Lint
        uses: home-assistant/actions/helpers/lint@master
        with:
          path: "./${{ matrix.addon }}"